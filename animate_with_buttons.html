<!DOCTYPE html>

<head>
	<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
	<script src="https://unpkg.com/scrollama"></script>
	<script src="https://unpkg.com/d3@5.9.1/dist/d3.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"
			integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
			crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/0.71/jquery.csv-0.71.min.js"></script>
	<link rel="stylesheet" href="css/style.css" />
	<style>
		#scrolly {
			position: relative;
			display: -webkit-box;
			display: -ms-flexbox;
			display: flex;
			background-color: #f3f3f3;
			padding: 1rem;
		}

			#scrolly > * {
				-webkit-box-flex: 1;
				-ms-flex: 1;
				flex: 1;
			}

		article {
			position: relative;
			padding: 0 1rem;
			max-width: 20rem;
		}

		figure {
			position: -webkit-sticky;
			position: sticky;
			width: 100%;
			margin: 0;
			-webkit-transform: translate3d(0, 0, 0);
			-moz-transform: translate3d(0, 0, 0);
			transform: translate3d(0, 0, 0);
			background-color: #8a8a8a;
			z-index: 0;
		}

			figure p {
				text-align: center;
				padding: 1rem;
				position: absolute;
				top: 50%;
				left: 50%;
				-moz-transform: translate(-50%, -50%);
				-webkit-transform: translate(-50%, -50%);
				transform: translate(-50%, -50%);
				font-size: 8rem;
				font-weight: 900;
				color: #fff;
			}

		.step {
			margin: 0 auto 2rem auto;
			background-color: #3b3b3b;
			color: #fff;
		}

			.step:last-child {
				margin-bottom: 0;
			}

			.step.is-active {
				background-color: goldenrod;
				color: #3b3b3b;
			}

			.step p {
				text-align: center;
				padding: 1rem;
				font-size: 1.5rem;
			}
	</style>
	<link rel="stylesheet" href="css/scroll.css" />
	<link rel="stylesheet" href="css/responsive.css" />
</head>
<body>
	<main>
		<nav>
			<a href="https://github.com/russellsamora/scrollama">scrollama.js</a>
			<div class="nav__examples">
				<p>Examples:</p>
				<a href="https://russellsamora.github.io/scrollama/basic">Basic</a>
				<a href="https://russellsamora.github.io/scrollama/progress">Progress</a>
				<a href="https://russellsamora.github.io/scrollama/sticky-side">Sticky Side</a>
				<a href="https://russellsamora.github.io/scrollama/sticky-overlay">Sticky Overlay</a>
				<a href="https://russellsamora.github.io/scrollama/mobile-pattern">Mobile Pattern</a>
			</div>
		</nav>
		<section id="intro">
			<h1 class="intro__hed">Sticky Side Example</h1>
			<p class="intro__dek">
				Start scrolling to see how it works.
			</p>
		</section>

		<section id="scrolly">
			<article>
				<div class="step is-active" data-step="1" style="height: 814px;" data-scrollama-index="0">
					<p>STEP 1</p>
				</div>
				<div class="step" data-step="2" style="height: 814px;" data-scrollama-index="1">
					<p>STEP 2</p>
				</div>
			
				<div class="step" data-step="3" style="height: 814px;" data-scrollama-index="2">
					<p>STEP 3</p>
				</div>
				<div class="step" data-step="4" style="height: 814px;" data-scrollama-index="3">
					<p>STEP 4</p>
				</div>
			</article>

			<figure style="height: 543px; top: 271.5px;">
				<div id="plotchart"></div>
			</figure>
		</section>

		<section id="outro"></section>
	</main>
	
	
	
	



	
	<script>

		// using d3 for convenience
		var main = d3.select("main");
		var scrolly = main.select("#scrolly");
		var figure = scrolly.select("figure");
		var article = scrolly.select("article");
		var step = article.selectAll(".step");

		// initialize the scrollama
		var scroller = scrollama();

		// generic window resize listener event
		function handleResize() {
			// 1. update height of step elements
			var stepH = Math.floor(window.innerHeight * 0.75);
			step.style("height", stepH + "px");

			var figureHeight = window.innerHeight / 2;
			var figureMarginTop = (window.innerHeight - figureHeight) / 2;

			figure
				.style("height", figureHeight + "px")
				.style("top", figureMarginTop + "px");

			// 3. tell scrollama to update new element dimensions
			scroller.resize();
		}

		// scrollama event handlers
		function handleStepEnter(response) {
			console.log(response);
			// response = { element, direction, index }

			// add color to current step only
			step.classed("is-active", function (d, i) {
				return i === response.index;
			});

			console.log(response.index)
			// update graphic based on step
			startAnimation(response.index);
		}

		function init() {

			// 1. force a resize on load to ensure proper dimensions are sent to scrollama
			handleResize();

			// 2. setup the scroller passing options
			// 		this will also initialize trigger observations
			// 3. bind scrollama event handlers (this can be chained like below)
			scroller
				.setup({
					step: "#scrolly article .step",
					offset: 0.33,
					debug: false
				})
				.onStepEnter(handleStepEnter);
		}

		// kick things off
		init();


		makePlot();

/*
		Plotly.plot('plotchart', [{
			x: [0, 0],
			y: [-1, 1],
		}], {
			xaxis: { range: [-Math.PI, Math.PI] },
			yaxis: { range: [-1.3, 1.3] }
		}, { showSendToCloud: true }).then(function () {
			Plotly.addFrames('graph', [
				{
					data: [{ x: [1, -.5], y: [0, .5] }],
					name: 'frame1'
				}, {
					data: [{ x: [0, 0], y: [-.25, .35] }],
					name: 'frame2'
				},
				{
					data: [{ x: [0, 1,2,4], y: [-1,4,-2, 1] }],
					name: 'frame3'
				}
			]);
		})*/
		

		function startAnimation(i) {
		
			var currentFrame = 'frame' + i
			console.log(currentFrame)

			Plotly.animate('plotchart', [currentFrame], {
				frame: [
					{ duration: 500 }
				],
				transition: [
					{ duration: 400, easing: 'cubic-in' }
				],
				mode: 'afterall'
			})
		}

		function makePlotly(chrono, value, series, text, xoffset, yoffset) {

			//Create two different data sets for the frames
			y = chrono.filter((v, i) => i % 2) //This is the default y variable

			//x values switch
			plot_value = value.filter((v, i) => !(i % 2))
			story_value = value.filter((v, i) => i % 2)

			//text values switch
			plot_text = text.filter((v, i) => i % 2)
			story_text = text.filter((v, i) => !(i % 2))


			/*    console.log(y, plot_value, story_value)*/

			//make helper functions to simplify this

			var data = [{
				type: "scatter",
				mode: "markers+text",
				x: plot_value,
				y: y,
				name: series[0],
				text: plot_text,
				textposition: ['top right',
					'bottom left',
					'top left'
				]

			}];

			var layout = {
				title: { text: "<b>Plot Structure Chart</b> <br>Major Events in Sutpen's Life" },
				showlegend: false,
				xaxis: {
					showgrid: false,
					title: { text: "Chapter" },
					autotick: false,
					tickmode: 'array',
					tickvals: [1, 2, 3, 4, 5, 6, 7, 8, 9],
					range: [0.5, 9]
				},
				yaxis: {
					title: { text: "Chronology" },
					showgrid: false,
					tickmode: 'array',
					tickvals: [1, 2, 3],
					zeroline: false
				},

				
			};


			var config = {
				responsive: true,
				displayModeBar: false
			}


			Plotly.plot('plotchart', {
				data: data,
				layout: layout,
				config: config
			}).then(function () {
				Plotly.addFrames('plotchart', [
					{
						name: 'frame0',
						data: [{
							x: plot_value,
							y: y,
							text: plot_text,
							name: series[0],
							textposition: ['top right',
								'bottom left',
								'top left'
							]
						}]
					},
					{
						name: 'frame1',
						data: [{
							x: story_value,
							y: y,
							text: plot_text,
							name: series[1],
							textposition: ['top right',
								'bottom left',
								'top right'
							]
						}]
					},
					{
						name: 'frame2',
						data: [{
							x: [1,3,2,2,2,3,1],
							y: [2,2,1,3,1,1,2],
							text:[],
							name: 'dummy',
							textposition: [],
						}]
					}
				]);
			})

		};


		function makePlot() {
			;
			$.ajax({
				type: "GET",
				url: "https://raw.githubusercontent.com/arundhatibala/absalom/main/data/sutpen_absalom_plot.csv",
				dataType: "text",
				success: function (response) {
				

					/*data = $.csv.toObjects(response, { headers: true });*/
					
					var allData = {};
					allData = processData(response)
console.log(allData)

				}
			});
		};


		function processData(response) {
		    
			data = $.csv.toObjects(response, { headers: true });

			plotData = {};

			/* console.log(allRows);
			 console.log(allRows.length)*/

			plotData.absalom_startdate = data.map(function (d) { return d['absalom_startdate']; });
			console.log(plotData)
			plotData.absalom_summary = data.map(function (d) { return d['absalom_summary']; });
			plotData.absalom_chapter = data.map(function (d) { return parseInt(d['absalom_chapter']); });
			plotData.absalom_y_narrated = data.map(function (d) { return parseInt(d['absalom_y_narrated']); });
			plotData.absalom_y_hypothesized = data.map(function (d) { return parseInt(d['absalom_y_hypothesized']); });
			plotData.absalom_y_narratedconsciousness = data.map(function (d) { return parseInt(d['absalom_y_narratedconsciousness']); });
			plotData.absalom_y_told = data.map(function (d) { return parseInt(d['absalom_y_told']); });
			plotData.absalom_y_remembered = data.map(function (d) { return parseInt(d['absalom_y_remembered']); });
			plotData.absalom_y_all = data.map(function (d) { return parseInt(d['absalom_y_all']); });
			plotData.absalom_y_other = data.map(function (d) { return parseInt(d['absalom_y_other']); });
			plotData.absalom_x_plot = data.map(function (d) { return parseInt(d['absalom_x_plot']); });
			plotData.absalom_x_story = data.map(function (d) { return parseInt(d['absalom_x_story']); });
			plotData.absalom_textposition_plot = data.map(function (d) { return d['absalom_textposition_plot']; });
			plotData.absalom_textposition_story = data.map(function (d) { return d['absalom_textposition_story']; });
			plotData.absalom_label = data.map(function (d) { return d['absalom_label']; });
			plotData.x_sutpen_plot = data.map(function (d) { return parseInt(d['x_sutpen_plot']); });
			plotData.x_sutpen_story = data.map(function (d) { return parseInt(d['x_sutpen_story']); });
			plotData.y_sutpen = data.map(function (d) { return parseInt(d['y_sutpen']); });
			plotData.series_sutpen_plot = data.map(function (d) { return d['series_sutpen_plot']; });
			plotData.series_sutpen_story = data.map(function (d) { return d['series_sutpen_story']; });
			plotData.sutpen_label = data.map(function (d) { return d['sutpen_label']; });
			plotData.textposition_sutpen_plot = data.map(function (d) { return d['textposition_sutpen_plot']; });
			plotData.textposition_sutpen_story = data.map(function (d) { return d['textposition_sutpen_story']; });

			/*
			var headers = Object.keys(data[0]);
			for (var i = 0; i < headers.length; i++) {
				plotData[headers[i]] = [];
				for (var j = 0; j < data.length; j++) {
					plotData[headers[i]].push(data[j][headers[i]]);
				}
			}*/

			console.log(plotData)


			/*var chrono = data.map(function (d) { return parseInt(d['Chrono']); });
			var value = data.map(function (d) { return parseInt(d['value']); });
			var series = data.map(function (d) { return d['series']; });
			var text = data.map(function (d) { return d['name']; });
			var xoffset = data.map(function (d) { return d['xoffset']; });
			var yoffset = data.map(function (d) { return d['yoffset']; });*/

			//makePlotly(plotData);
			return plotData
		}
		
		
	</script>
</body>